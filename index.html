<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Irys Shooter</title>
  <link rel="stylesheet" href="styles/style.css">
</head>
<body>
  <div id="app">
    <div style="color: white; text-align: center; padding: 50px;">
      <h1>Loading...</h1>
      <p>If this message persists, check the browser console for errors.</p>
    </div>
  </div>
  
  <!-- ethers.js CDN -->
  <script 
    src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"
    onload="console.log('✅ ethers.js loaded successfully:', typeof ethers !== 'undefined' ? ethers.version : 'FAILED')"
    onerror="console.error('❌ Failed to load ethers.js from CDN')"
  ></script>
  
  <!-- Load Irys Contract Integration -->
  <script src="./irys-contract-integration.js" 
    onload="console.log('✅ IrysContractIntegration loaded:', typeof window.IrysContractIntegration !== 'undefined')"
    onerror="console.error('❌ Failed to load irys-contract-integration.js')"></script>
  
  <!-- Load Irys Network Integration as fallback -->
  <script src="./js/simple-blockchain-integration.js" 
    onload="console.log('✅ SimpleBlockchainIntegration loaded:', typeof window.SimpleBlockchainIntegration !== 'undefined')"
    onerror="console.error('❌ Failed to load simple-blockchain-integration.js')"></script>
  
  <!-- Inline fallback integration for production -->
  <script>
    // Inline fallback if external scripts fail to load
    if (typeof window.SimpleBlockchainIntegration === 'undefined') {
      console.log('🔄 Creating inline fallback integration...');
      
      window.SimpleBlockchainIntegration = {
        async initialize(provider) {
          console.log('🔄 Inline fallback: Initializing...');
          try {
            if (typeof ethers === 'undefined') {
              throw new Error('ethers.js not available');
            }
            
            // Simple initialization without network switching for fallback
            const ethersProvider = new ethers.providers.Web3Provider(provider);
            const network = await ethersProvider.getNetwork();
            console.log(`🌐 Connected to network: ${network.chainId}`);
            
            return true;
          } catch (error) {
            console.error('❌ Inline fallback failed:', error);
            return false;
          }
        },
        
        async startGameSession(gameMode, walletAddress) {
          console.log(`🚀 Inline fallback: Starting ${gameMode} game session`);
          
          // Mock successful transaction for fallback
          return {
            success: true,
            smartContractTxHash: '0x' + Math.random().toString(16).substr(2, 64),
            irysTransactionId: 'fallback_' + Date.now(),
            sessionId: 'session_' + Date.now(),
            gameData: {
              gameMode,
              playerAddress: walletAddress,
              timestamp: Date.now(),
              action: "startGame",
              version: "fallback"
            }
          };
        },
        
        async endGameSession(sessionId, score, walletAddress) {
          console.log(`🏁 Inline fallback: Ending game session ${sessionId} with score ${score}`);
          
          return {
            success: true,
            smartContractTxHash: '0x' + Math.random().toString(16).substr(2, 64),
            irysTransactionId: 'fallback_end_' + Date.now(),
            sessionId: sessionId
          };
        }
      };
      
      console.log('✅ Inline fallback integration created');
    }
  </script>
  
  <!-- Load main application inline -->
  <script>
    console.log('🚀 Inline app starting...');
    
    // Simple app initialization
    function initApp() {
      console.log('🎯 Initializing inline app...');
      
      const app = document.getElementById('app');
      
      // Set background
      document.body.style.background = "url('/menu-bg.jpg') center center / cover no-repeat fixed";
      
      // Show main menu
      app.innerHTML = `
        <div class="main-menu" style="min-height: 100vh; width: 100vw; display: flex; flex-direction: column; align-items: center; justify-content: center;">
          <h1 style="background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); border: 2px solid #43cea2; border-radius: 18px; padding: 24px 36px; margin: 0 0 32px 0; color: #2193b0; font-size: 2.5rem; font-weight: bold;">Irys Shooter</h1>
          
          <div class="buttons-container" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); border: 3px solid rgba(255,255,255,0.8); border-radius: 24px; padding: 32px 24px; display: flex; flex-direction: column; align-items: center; gap: 16px;">
            <button onclick="showGameDemo()" style="padding: 14px 30px; font-size: 1.1rem; border-radius: 12px; border: none; background: #43cea2; color: #fff; font-weight: bold; cursor: pointer; width: 200px;">🎮 Play Demo</button>
            <button onclick="showWalletDemo()" style="padding: 14px 30px; font-size: 1.1rem; border-radius: 12px; border: none; background: #43cea2; color: #fff; font-weight: bold; cursor: pointer; width: 200px;">🔗 Connect Wallet</button>
            <button onclick="showLeaderboardDemo()" style="padding: 14px 30px; font-size: 1.1rem; border-radius: 12px; border: none; background: #43cea2; color: #fff; font-weight: bold; cursor: pointer; width: 200px;">🏆 Leaderboard</button>
            <button onclick="showSettingsDemo()" style="padding: 14px 30px; font-size: 1.1rem; border-radius: 12px; border: none; background: #43cea2; color: #fff; font-weight: bold; cursor: pointer; width: 200px;">⚙️ Settings</button>
          </div>
        </div>
      `;
      
      console.log('✅ Main menu displayed');
    }
    
    // Demo functions
    function showGameDemo() {
      console.log('🎮 Game demo clicked');
      const app = document.getElementById('app');
      app.innerHTML = `
        <div style="text-align: center; padding: 50px; color: white;">
          <h2>🎮 Game Demo</h2>
          <div style="margin: 30px 0;">
            <p>✨ Particle colors now match bubble types!</p>
            <p>🔗 Blockchain integration with fallback</p>
            <p>🎯 Game would start here with bubble shooter</p>
          </div>
          <div style="margin: 20px 0;">
            <button onclick="startGameMode('endless')" style="padding: 20px 40px; margin: 10px; font-size: 1.2rem; border: none; border-radius: 12px; background: #43cea2; color: white; cursor: pointer;">🎯 Endless Mode</button>
            <button onclick="startGameMode('timed')" style="padding: 20px 40px; margin: 10px; font-size: 1.2rem; border: none; border-radius: 12px; background: #4096ee; color: white; cursor: pointer;">⏱️ 1 Minute Mode</button>
          </div>
          <button onclick="initApp()" style="padding: 15px 30px; font-size: 1.1rem; border: none; border-radius: 12px; background: #e74c3c; color: white; cursor: pointer;">🏠 Back to Menu</button>
        </div>
      `;
    }
    
    function startGameMode(mode) {
      console.log('🚀 Starting game mode:', mode);
      
      // Use inline fallback if available
      if (typeof window.SimpleBlockchainIntegration !== 'undefined') {
        window.SimpleBlockchainIntegration.startGameSession(mode, '0x1234567890123456789012345678901234567890')
          .then(result => {
            if (result.success) {
              const app = document.getElementById('app');
              app.innerHTML = `
                <div style="text-align: center; padding: 50px; color: white;">
                  <h2>🎮 Game Started!</h2>
                  <div style="margin: 30px 0;">
                    <p><strong>Mode:</strong> ${mode}</p>
                    <p><strong>Session ID:</strong> ${result.sessionId}</p>
                    <p><strong>Mock TX:</strong> ${result.smartContractTxHash.substring(0, 20)}...</p>
                  </div>
                  <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <p>🎯 Bubble shooter game would load here</p>
                    <p>✨ With colorful particle effects</p>
                    <p>🔗 Blockchain transaction confirmed (mock)</p>
                  </div>
                  <button onclick="initApp()" style="padding: 15px 30px; font-size: 1.1rem; border: none; border-radius: 12px; background: #43cea2; color: white; cursor: pointer;">🏠 Back to Menu</button>
                </div>
              `;
            }
          })
          .catch(error => {
            console.error('Game start failed:', error);
            alert('Game start failed: ' + error.message);
          });
      } else {
        alert('Blockchain integration not available');
      }
    }
    
    function showWalletDemo() {
      console.log('🔗 Wallet demo clicked');
      const app = document.getElementById('app');
      app.innerHTML = `
        <div style="text-align: center; padding: 50px; color: white;">
          <h2>🔗 Wallet Connection Demo</h2>
          <div style="margin: 30px 0;">
            <p>Wallet connection functionality would be here</p>
            <p>Supports MetaMask, Rabby, OKX wallets</p>
          </div>
          <button onclick="initApp()" style="padding: 15px 30px; font-size: 1.1rem; border: none; border-radius: 12px; background: #43cea2; color: white; cursor: pointer;">🏠 Back to Menu</button>
        </div>
      `;
    }
    
    function showLeaderboardDemo() {
      console.log('🏆 Leaderboard demo clicked');
      const app = document.getElementById('app');
      app.innerHTML = `
        <div style="text-align: center; padding: 50px; color: white;">
          <h2>🏆 Leaderboard Demo</h2>
          <div style="margin: 30px 0;">
            <p>Leaderboard with top scores would be here</p>
            <p>Stored locally and on blockchain</p>
          </div>
          <button onclick="initApp()" style="padding: 15px 30px; font-size: 1.1rem; border: none; border-radius: 12px; background: #43cea2; color: white; cursor: pointer;">🏠 Back to Menu</button>
        </div>
      `;
    }
    
    function showSettingsDemo() {
      console.log('⚙️ Settings demo clicked');
      const app = document.getElementById('app');
      app.innerHTML = `
        <div style="text-align: center; padding: 50px; color: white;">
          <h2>⚙️ Settings Demo</h2>
          <div style="margin: 30px 0;">
            <p>Game settings would be here</p>
            <p>Player name, sound settings, etc.</p>
          </div>
          <button onclick="initApp()" style="padding: 15px 30px; font-size: 1.1rem; border: none; border-radius: 12px; background: #43cea2; color: white; cursor: pointer;">🏠 Back to Menu</button>
        </div>
      `;
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
    
    console.log('✅ Inline app script loaded');
  </script>
</body>
</html>