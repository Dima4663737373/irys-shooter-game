<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –õ—ñ–¥–µ—Ä–±–æ—Ä–¥–∞</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .result { background: #e9ecef; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üéØ –¢–µ—Å—Ç –õ—ñ–¥–µ—Ä–±–æ—Ä–¥–∞</h1>
    
    <div class="container">
        <h3>1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
        <input type="text" id="contractAddress" placeholder="–ê–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É" style="width: 400px;">
        <button onclick="setContractAddress()">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∞–¥—Ä–µ—Å—É</button>
        <button onclick="initializeLeaderboard()">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
    </div>
    
    <div class="container">
        <h3>2. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è</h3>
        <button onclick="connectWallet()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ MetaMask</button>
        <div id="walletStatus" class="result">–ì–∞–º–∞–Ω–µ—Ü—å –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>
    </div>
    
    <div class="container">
        <h3>3. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É</h3>
        <input type="number" id="scoreInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ä–∞—Ö—É–Ω–æ–∫" min="0">
        <button onclick="saveScore()">–ó–±–µ—Ä–µ–≥—Ç–∏ —Ä–∞—Ö—É–Ω–æ–∫</button>
        <div id="saveResult" class="result"></div>
    </div>
    
    <div class="container">
        <h3>4. –ü–µ—Ä–µ–≥–ª—è–¥ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥–∞</h3>
        <button onclick="getTopPlayers()">–¢–æ–ø 10 –≥—Ä–∞–≤—Ü—ñ–≤</button>
        <button onclick="getMyScore()">–ú—ñ–π —Ä–∞—Ö—É–Ω–æ–∫</button>
        <button onclick="getTotalPlayers()">–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</button>
        <div id="leaderboardResult" class="result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="js/leaderboard-integration.js"></script>
    <script>
        let leaderboard = null;
        let currentAccount = null;

        function setContractAddress() {
            const address = document.getElementById('contractAddress').value;
            if (!address) {
                alert('–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É!');
                return;
            }
            
            if (!leaderboard) {
                leaderboard = new LeaderboardIntegration();
            }
            
            leaderboard.setContractAddress(address);
            showResult('saveResult', `–ê–¥—Ä–µ—Å–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${address}`, 'success');
        }

        async function initializeLeaderboard() {
            try {
                if (!leaderboard) {
                    leaderboard = new LeaderboardIntegration();
                }
                
                await leaderboard.initialize();
                showResult('saveResult', '–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!', 'success');
            } catch (error) {
                showResult('saveResult', `–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ${error.message}`, 'error');
            }
        }

        async function connectWallet() {
            try {
                if (!leaderboard) {
                    throw new Error('–°–ø–æ—á–∞—Ç–∫—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π—Ç–µ –ª—ñ–¥–µ—Ä–±–æ—Ä–¥');
                }
                
                currentAccount = await leaderboard.connectWallet();
                document.getElementById('walletStatus').innerHTML = `–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: ${currentAccount}`;
                document.getElementById('walletStatus').className = 'result success';
            } catch (error) {
                showResult('walletStatus', `–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ${error.message}`, 'error');
            }
        }

        async function saveScore() {
            try {
                const score = document.getElementById('scoreInput').value;
                if (!score || score <= 0) {
                    throw new Error('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫');
                }
                
                if (!leaderboard) {
                    throw new Error('–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                }
                
                showResult('saveResult', '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É...', 'success');
                const result = await leaderboard.saveScore(parseInt(score));
                showResult('saveResult', `–†–∞—Ö—É–Ω–æ–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ! –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è: ${result.transactionHash}`, 'success');
            } catch (error) {
                showResult('saveResult', `–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${error.message}`, 'error');
            }
        }

        async function getTopPlayers() {
            try {
                if (!leaderboard) {
                    throw new Error('–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                }
                
                const topPlayers = await leaderboard.getTopPlayers(10);
                let html = '<h4>üèÜ –¢–æ–ø –≥—Ä–∞–≤—Ü—ñ:</h4>';
                
                if (topPlayers.length === 0) {
                    html += '<p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –≥—Ä–∞–≤—Ü—ñ–≤</p>';
                } else {
                    topPlayers.forEach((player, index) => {
                        const date = new Date(player.timestamp * 1000).toLocaleString();
                        html += `<p><strong>${index + 1}.</strong> ${player.player.substring(0, 10)}... - ${player.score} –æ—á–æ–∫ (${date})</p>`;
                    });
                }
                
                showResult('leaderboardResult', html, 'success');
            } catch (error) {
                showResult('leaderboardResult', `–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–ø –≥—Ä–∞–≤—Ü—ñ–≤: ${error.message}`, 'error');
            }
        }

        async function getMyScore() {
            try {
                if (!currentAccount) {
                    throw new Error('–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≥–∞–º–∞–Ω–µ—Ü—å');
                }
                
                if (!leaderboard) {
                    throw new Error('–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                }
                
                const myScore = await leaderboard.getPlayerScore(currentAccount);
                const date = myScore.timestamp > 0 ? new Date(myScore.timestamp * 1000).toLocaleString() : '–ù–µ–º–∞—î';
                
                showResult('leaderboardResult', 
                    `<h4>üìä –í–∞—à —Ä–∞—Ö—É–Ω–æ–∫:</h4>
                     <p>–†–∞—Ö—É–Ω–æ–∫: ${myScore.score}</p>
                     <p>–î–∞—Ç–∞: ${date}</p>`, 'success');
            } catch (error) {
                showResult('leaderboardResult', `–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—É: ${error.message}`, 'error');
            }
        }

        async function getTotalPlayers() {
            try {
                if (!leaderboard) {
                    throw new Error('–õ—ñ–¥–µ—Ä–±–æ—Ä–¥ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
                }
                
                const total = await leaderboard.getTotalPlayers();
                showResult('leaderboardResult', `<h4>üë• –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä–∞–≤—Ü—ñ–≤: ${total}</h4>`, 'success');
            } catch (error) {
                showResult('leaderboardResult', `–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ: ${error.message}`, 'error');
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `result ${type}`;
        }
    </script>
</body>
</html>